<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>头部导航栏布局</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div class="outer">
        <!-- 头部区域 -->
        <header class="header">
            <div class="headerTop_out">
                <div class="headerTop">
                    <div class="headerTop_left">
                        <p>尚品汇欢迎您</p>
                        <p>
                            请
                            <a href="javascript:;">登录</a>
                            <a href="javascript:;">免费注册</a>
                        </p>
                    </div>
                    <div class="headerTop_right">
                        <a href="javascript:;">我的订单</a>
                        <a href="javascript:;">我的购物车</a>
                        <a href="javascript:;">我的尚品汇</a>
                        <a href="javascript:;">尚品汇会员</a>
                        <a href="javascript:;">企业采购</a>
                        <a href="javascript:;">关注尚品汇</a>
                        <a href="javascript:;">合作招聘</a>
                        <a href="javascript:;">商家后台</a>
                    </div>
                </div>

            </div>
            <div class="headerBottom">
                <h1 class="logo">
                    <a href="javascript:;">
                        <img src="./images/Logo.png" alt="">
                    </a>
                </h1>
                <div class="header_search">
                    <input type="text">
                    <button>搜索</button>
                </div>
            </div>
        </header>
        <div class="allnav_outer">
            <div class="allnav">
                <h2>所有商品分类</h2>
                <nav>
                    <a href="javascript:;">服装城</a>
                    <a href="javascript:;">美妆馆</a>
                    <a href="javascript:;">尚品汇超市</a>
                    <a href="javascript:;">全球购</a>
                    <a href="javascript:;">闪购</a>
                    <a href="javascript:;">团购</a>
                    <a href="javascript:;">有趣</a>
                    <a href="javascript:;">秒杀</a>
                </nav>
            </div>
        </div>
        <section class="con">
            <div class="conPoint">
                <a href="javascript:;">手机、数码、通讯手机</a>
                <a href="javascript:;">Apple苹果</a>
                <a>iphone 6S系类</a>
            </div>
            <div class="mainCon">
                <div class="previewArea">
                    <div class="preview">
                        <!-- 小图区域 -->
                        <div class="smallArea">
                            <img src="./images/s1.png" alt="">
                            <!-- 蒙版区域 -->
                            <!-- <div class="mask"></div> -->
                        </div>
                        <!-- 大图区域 -->
                        <!-- <div class="bigArea">
                            <img src="./images/b1.png" alt="">
                        </div> -->
                    </div>
                    <div class="prescroll">
                        <p class="left">&lt;</p>
                        <div class="listOut">
                            <ul class="list">
                            </ul>
                        </div>
                        <p class="right">&gt;</p>
                    </div>
                </div>
                <div class="detailArea">
                    <div class="priceArea">

                    </div>
                    <div class="chooseInsert">
                    </div>
                    <div class="chooseArea">

                    </div>
                    <div class="goodsNum">
                        <div class="num">
                            <input type="text" value="1">
                            <button class="plus">+</button>
                            <button class="mins">-</button>
                        </div>
                        <div class="addCart">加入购物车</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 商品详情展示页 -->
        <div class="productDetial">
            <aside class="aside">
                <div class="tabTitle">
                    <h4 class="active">相关分类</h4>
                    <h4>推荐品牌</h4>
                </div>
                <div class="tabContent">
                    <div class="tab-pane active">
                        <ul class='partList'>
                            <li><a href="javascript:;"> 手机</a></li>
                            <li><a href="javascript:;">手机壳</a></li>
                            <li><a href="javascript:;">内存卡</a></li>
                            <li><a href="javascript:;">Iphone配件</a></li>
                            <li><a href="javascript:;">贴膜</a></li>
                            <li><a href="javascript:;">手机耳机</a></li>
                            <li><a href="javascript:;">移动电源</a></li>
                            <li><a href="javascript:;">平板电脑</a></li>
                        </ul>
                        <ul class="goodList">
                            <li>
                                <div class="detailImg"><img src="./images/part01.png" alt=""></div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <div class="addCart"><a href="">加入购物车</a></div>
                            </li>
                            <li>
                                <div class="detailImg"><img src="./images/part01.png" alt=""></div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <div class="addCart"><a href="">加入购物车</a></div>
                            </li>
                            <li>
                                <div class="detailImg"><img src="./images/part01.png" alt=""></div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <div class="addCart"><a href="">加入购物车</a></div>
                            </li>
                            <li>
                                <div class="detailImg"><img src="./images/part01.png" alt=""></div>
                                <h4>Apple苹果iPhone 6s (A1699)</h4>
                                <p>¥6088.00</p>
                                <div class="addCart"><a href="">加入购物车</a></div>
                            </li>
                        </ul>
                    </div>
                    <div class="tab-pane">
                        推荐品牌
                    </div>
                </div>
            </aside>
            <div class="detail">
                <div class="fitting">
                    <h4 class="kt">选择搭配</h4>
                    <div class="good-suits">
                        <div class="master">
                            <img src="./images/l-m01.png" alt="">
                            <p>¥5299</p>
                            <i>+</i>
                        </div>
                        <ul class="suits">
                            <li class="suitsItem">
                                <img src="./images/dp01.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox" value="39">
                                    <span>39</span>
                                </label>
                            </li>
                            <li class="suitsItem">
                                <img src="./images/dp02.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox" value="50">
                                    <span>50</span>
                                </label>
                            </li>
                            <li class="suitsItem">
                                <img src="./images/dp03.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox" value="59">
                                    <span>59</span>
                                </label>
                            </li>
                            <li class="suitsItem">
                                <img src="./images/dp04.png" alt="">
                                <p>Feless费勒斯VR</p>
                                <label>
                                    <input type="checkbox" value="99">
                                    <span>99</span>
                                </label>
                            </li>
                        </ul>
                        <div class="result">
                            <div class="num">已选购0件商品</div>
                            <p class="price-tit">套餐价</p>
                            <p class="price">¥5299</p>
                            <button class="addShopcar">加入购物车</button>
                        </div>
                    </div>
                </div>
                <div class="intro">
                    <ul class="tab-wraped">
                        <li class="active">
                            <a href="###">商品介绍</a>
                        </li>
                        <li class="">
                            <a href="###">规格与包装</a>
                        </li>
                        <li class="">
                            <a href="###">售后保障</a>
                        </li>
                        <li class="">
                            <a href="###">商品评价</a>
                        </li>
                        <li class="">
                            <a href="###">手机社区</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div id="one" class="tab-pane active">
                            <ul class="goods-intro">
                                <li>分辨率：1920*1080(FHD)</li>
                                <li>后置摄像头：1200万像素</li>
                                <li>前置摄像头：500万像素</li>
                                <li>核 数：其他</li>
                                <li>频 率：以官网信息为准</li>
                                <li>品牌： Apple</li>
                                <li>商品名称：APPLEiPhone 6s Plus</li>
                                <li>商品编号：1861098</li>
                                <li>商品产地：中国大陆</li>
                                <li>商品毛重：0.51kg</li>
                                <li>热点：指纹识别，Apple Pay，金属机身，拍照神器</li>
                                <li>系统：苹果（IOS）</li>
                                <li>像素：1000-1600万品毛重：0.51kg</li>
                                <li>机身内存：64GB</li>
                            </ul>
                            <div class="intro-detail">
                                <img src="./images/intro01.png" alt="">
                                <img src="./images/intro02.png" alt="">
                                <img src="./images/intro03.png" alt="">
                            </div>
                        </div>
                        <div id="two" class="tab-pane">规格与包装</div>
                        <div id="three" class="tab-pane">售后保障</div>
                        <div id="four" class="tab-pane">商品评价</div>
                        <div id="five" class="tab-pane">手机社区</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./js/data.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            var thumbnailIndex = 0;
            var goodsCount = 1; //初始数量
            //每一个功能封装一个函数，避免变量冲突，减少使用全局变量
            manifier();

            function manifier() {
                /* 
                    1.鼠标移入，创建蒙版和大图，并插入到页面中
                    2.鼠标移动，鼠标永远在蒙版的中心，鼠标移动，获取蒙版移动的位置信息
                    3.鼠标移出，删除事件
                
                 */
                var oPreview = document.querySelector('.preview');
                var oSmallArea = document.querySelector(".smallArea");
                var oMask = null;
                var oBigImg = null;
                var oBigArea = null;
                var data = goodData.imgsrc;
                oPreview.onmouseenter = function () {
                    oMask = document.createElement("div");
                    oMask.classList.add("mask");
                    oSmallArea.appendChild(oMask);

                    oBigArea = document.createElement("div");
                    oBigArea.classList.add("bigArea");
                    oBigImg = new Image();
                    oBigImg.src = data[thumbnailIndex].b;
                    oBigArea.appendChild(oBigImg);
                    oPreview.appendChild(oBigArea);

                    oPreview.onmousemove = function (e) {
                        var oMaskMove = {
                            x: e.clientX - oSmallArea.getBoundingClientRect().left - oMask
                                .offsetWidth / 2,
                            y: e.clientY - oSmallArea.getBoundingClientRect().top - oMask
                                .offsetHeight / 2,
                        }

                        //临界值判断
                        if (oMaskMove.x >= oSmallArea.offsetWidth - oMask.offsetWidth) {
                            oMaskMove.x = oSmallArea.offsetWidth - oMask.offsetWidth
                        } else if (oMaskMove.x <= 0) {
                            oMaskMove.x = 0;
                        }
                        if (oMaskMove.y >= oSmallArea.offsetHeight - oMask.offsetHeight) {
                            oMaskMove.y = oSmallArea.offsetHeight - oMask.offsetHeight
                        } else if (oMaskMove.y <= 0) {
                            oMaskMove.y = 0;
                        }

                        oMask.style.left = oMaskMove.x + "px"
                        oMask.style.top = oMaskMove.y + "px"


                        var scale = (oBigImg.offsetWidth - oBigArea.clientWidth) / (oSmallArea
                            .clientWidth -
                            oMask.offsetWidth);
                        var oBigImgMove = {
                            x: oMaskMove.x * scale,
                            y: oMaskMove.y * scale,
                        }
                        oBigImg.style.left = -oBigImgMove.x + "px";
                        oBigImg.style.top = -oBigImgMove.y + "px";
                    }
                    oPreview.onmouseleave = function () {
                        oSmallArea.removeChild(oMask);
                        oPreview.removeChild(oBigArea);
                        oPreview.onmousemove = null;
                        oPreview.onmouseleave = null;
                        oMask = null;
                        oBigImg = null;
                        oBigArea = null;
                    }


                }

            }



            thumbnailData();

            function thumbnailData() {
                var data = goodData.imgsrc;
                var oList = document.querySelector('.listOut .list')
                data.forEach(function (item) {
                    var newLi = document.createElement("li");
                    var newImg = new Image();
                    newImg.src = item.s;
                    newLi.appendChild(newImg);
                    oList.appendChild(newLi);
                })
            }



            thumbnailMove();

            function thumbnailMove() {
                /* 
                    1.用一个变量保存初始化位置（初始化位置会改变）
                    2.获取可以移动的总距离(li的总长度减去屏幕中显示的总长度  * li的宽度)
                    3.获取每次移动的距离
                    4.点击右侧按钮 让初始化变量累加每次移动的距离

                    5.每次点击按钮的时候，如果还剩下两张以上的图片，则正常走，否则直接走到末尾
                */
                var oListLis = document.querySelectorAll('.listOut .list li')
                var oList = document.querySelector('.listOut .list')
                var oRight = document.querySelector('.previewArea .prescroll .right')
                var oLeft = document.querySelector('.previewArea .prescroll .left')
                var tempLength = 0;
                var allMove = (oListLis.length - 5) * oListLis[0].offsetWidth;
                var everyMove = 2 * oListLis[0].offsetWidth;
                oRight.onclick = function () {
                    if (allMove - tempLength >= everyMove) {
                        tempLength += everyMove;
                    } else {
                        tempLength = allMove;
                    }
                    oList.style.transform = "translateX(-" + tempLength + "px)";
                }

                oLeft.onclick = function () {
                    if (tempLength >= everyMove) {
                        tempLength -= everyMove;
                    } else {
                        tempLength = 0;
                    }
                    oList.style.transform = "translateX(-" + tempLength + "px)";
                }
            }


            //点击缩略图
            thumbnailClick();

            function thumbnailClick() {
                var oListLisImg = document.querySelectorAll('.listOut .list li img');
                var oSmallAreaImg = document.querySelector('.smallArea img')
                oListLisImg.forEach(function (item, index) {
                    item.onclick = function () {
                        oSmallAreaImg.src = item.src;
                        thumbnailIndex = index;
                    }
                })
            }

            //价格区域数据动态加载
            priceAreaData();

            function priceAreaData() {

                var oPriceArea = document.querySelector('.priceArea');
                var data = goodData.goodsDetail;
                var str = `<h3 class="title">${data.title}</h3>
                        <p class="con">${data.recommend}</p>
                        <div class="price">
                            <div class="priceDetail">
                                <p>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</p>
                                <p>￥ <span>${data.price}</span> 元</p>
                            </div>
                            <div class="buy">
                                <p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</p>
                                <p><span>${data.promoteSales.type}</span>${data.promoteSales.content}</p>
                            </div>
                        </div>
                        <div class="support">
                            <div class="supportDetail">
                                <p>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</p>
                                <p>${data.support}</p>
                            </div>
                            <div class="address">
                                <p>配&nbsp;送&nbsp;至</p>
                                <p>${data.address}</p>
                            </div>
                        </div>`
                oPriceArea.innerHTML = str;

            }


            chooseData();

            function chooseData() {
                var data = goodData.goodsDetail.crumbData;
                var oChooseArea = document.querySelector('.chooseArea')
                data.forEach(function (item) {
                    //遍历数据生成dl
                    var oDl = document.createElement("dl");
                    // 遍历生成dt
                    var oDt = document.createElement("dt");
                    oDt.innerHTML = item.title;
                    //插入dt
                    oDl.appendChild(oDt);
                    //遍历生成dd
                    item.data.forEach(function (item) {
                        var oDd = document.createElement("dd");
                        oDd.innerHTML = item.type;
                        //给dd扩展一个自定义属性，保存的是当前选项价钱的改变
                        oDd.dataset.changePrice = item.changePrice;
                        //把dd插入到dl中
                        oDl.appendChild(oDd);
                    })
                    console.log(oDl)
                    //把dl插入到页面中
                    oChooseArea.appendChild(oDl);
                })
            }


            chooseClick();

            function chooseClick() {
                //创建一个数组，默认值都是0,选中的元素全部添加到数组中管理
                var arr = new Array(4);
                arr.fill(0);

                var oDl = document.querySelectorAll('.chooseArea dl')
                var oChooseInsert = document.querySelector('.chooseInsert')
                // 1.点击dd 可以把当前点击的dd所在的dl的其他颜色清空，只给当前点击的元素添加颜色
                //首先获取所有的dl，然后给每一个dl的dd去绑定点击事件，用来隔离开多个dl中的dd
                oDl.forEach(function (item, index) {
                    item.index = index; //给所有的dl一个下标
                    //不要给dl绑定，而是获取当前dl中所有的dd去绑定
                    // var oDlDd = document.querySelectorAll(`.chooseArea dl:nth-child(${index + 1}) dd`);
                    // console.log(oDlDd)
                    var oDlDd = item.querySelectorAll("dd");
                    console.log(oDlDd)

                    //给当前dl中所有的dd绑定点击事件
                    oDlDd.forEach(function (item, i) {
                        item.onclick = function () {
                            //先清空当前dl中所有dd的样式
                            oDlDd.forEach(function (item, index) {
                                item.style.color = "#666";
                            })
                            //给当前点击的dd添加颜色
                            this.style.color = "red";

                            //点击以后 把当前点击的dd元素放在 数组中（当前dd所在的dl对应的数组下标）
                            arr[index] = this; //index使用的是遍历dl的时候的index


                            //每次创建mark的时候 先清空mark的父级
                            oChooseInsert.innerHTML = ""
                            //每次都遍历数组，创建mark标签，并插入到页面中
                            arr.forEach(function (item, i) {
                                //数组有4个值，当某个值是有效值的时候，就创建mark
                                if (item) {
                                    var oMark = document.createElement("mark");
                                    oMark.innerHTML = item.innerHTML;
                                    // 给mark标签添加删除按钮
                                    var oDele = document.createElement("a");
                                    oDele.innerHTML = "X";
                                    //给a标签保存一个自定义属性，保存当前a代表的dl的下标
                                    oDele.dataset.index = i;
                                    oMark.appendChild(oDele)
                                    oChooseInsert.appendChild(oMark)
                                }
                            })


                            //每次点击以后，会创建mark，创建mark之后，获取mark中所有的删除按钮，绑定删除事件
                            var oDele = document.querySelectorAll('mark a');
                            oDele.forEach(function (item, index) {
                                item.onclick = function () {
                                    //点击删除后，获取当前删除a标签所对应的dl的下标

                                    //点击删除后，要删除当前元素，并且让默认颜色回到第一个dd
                                    //点击删除的时候，要知道当前删除的元素 是对应的哪一个dl的dd

                                    item.parentNode.parentNode.removeChild(item
                                        .parentNode); //删除元素

                                    // item.dataset.index:当前删除元素 所对应的dl的下标
                                    var oDeleDlIndex = item.dataset.index;
                                    //删除选中后，要删除数组
                                    arr[oDeleDlIndex] = 0;


                                    //清空当前删除元素 所对应的dl的全部dd样式，并且给默认第一个添加
                                    var oDeleDlDd = oDl[oDeleDlIndex]
                                        .querySelectorAll("dd");
                                    oDeleDlDd.forEach(function (item) {
                                        item.style.color = "#666";
                                    })
                                    oDeleDlDd[0].style.color = "red";


                                    //删除以后计算价钱
                                    addPrice(arr);
                                }
                            })
                            addPrice(arr);
                        }
                    })
                })

                //封装计算价钱函数，只要添加或者删除，数组就会发生变化，可以根据每次数组的变化，计算价钱
                function addPrice(arr) {
                    //获取最初始的价钱
                    var oPrice = document.querySelector('.priceDetail span')
                    var startPrice = goodData.goodsDetail.price * goodsCount;
                    arr.forEach(function (item) {
                        if (item) {
                            startPrice += parseInt(item.dataset.changePrice) * goodsCount;
                        }
                    })
                    console.log(startPrice)
                    oPrice.innerHTML = startPrice;

                    //得到最终价钱以后，需要赋值给选择搭配的价钱
                    var oMasterPrice = document.querySelector('.good-suits .master p');
                    oMasterPrice.innerHTML = "￥" + startPrice;
                }
            }


            goodsNum();

            function goodsNum() {
                var oPlus = document.querySelector('.goodsNum .plus')
                var oMins = document.querySelector('.goodsNum .mins')
                var oInput = document.querySelector('.goodsNum input')

                //给加号绑定点击事件
                oPlus.onclick = function () {
                    goodsCount++;
                    oInput.value = goodsCount;
                    //加法运算后，处理价钱
                    //先获取当前价格的标签
                    var oPrice = document.querySelector('.priceDetail span');
                    var nowPrice = parseInt(oPrice.innerHTML); //获取改变前的价钱

                    //计算新的价格： 要先算出单价 然后再乘数量
                    var newPrice = nowPrice / (goodsCount - 1) * goodsCount;
                    oPrice.innerHTML = newPrice;

                    //得到最终价钱以后，需要赋值给选择搭配的价钱
                    var oMasterPrice = document.querySelector('.good-suits .master p');
                    oMasterPrice.innerHTML = "￥" + newPrice;
                }
                oMins.onclick = function () {
                    goodsCount--;
                    if (goodsCount < 1) {
                        goodsCount = 1;
                        return;
                    }
                    oInput.value = goodsCount;

                    //减法运算后，处理价钱
                    //先获取当前价格的标签
                    var oPrice = document.querySelector('.priceDetail span');
                    var nowPrice = parseInt(oPrice.innerHTML); //获取改变前的价钱

                    //计算新的价格： 要先算出单价 然后再乘数量
                    var newPrice = nowPrice / (goodsCount + 1) * goodsCount;
                    oPrice.innerHTML = newPrice;

                    //得到最终价钱以后，需要赋值给选择搭配的价钱
                    var oMasterPrice = document.querySelector('.good-suits .master p');
                    oMasterPrice.innerHTML = "￥" + newPrice;
                }

            }

            //选择搭配项目
            chooseProduct();

            function chooseProduct() {
                //获取搭配的初始价钱标签
                var oMasterPrice = document.querySelector('.good-suits .master p');
                //获取套餐价的标签
                var oResultPrice = document.querySelector('.result .price');
                //获取数据中的初始价钱
                var startPrice = goodData.goodsDetail.price;
                //设置价钱
                oMasterPrice.innerHTML = "￥" + startPrice;
                oResultPrice.innerHTML = "￥" + startPrice;


                //对所有的搭配的多选框绑定点击事件
                var oInputs = document.querySelectorAll('.suitsItem label input[type=checkbox]');
                console.log(oInputs)
                oInputs.forEach(function (item) {
                    //对所有的input绑定点击事件
                    item.onclick = function () {
                        var num = 0; //计数器
                        //只要input被点击 就重新遍历所有的input 把被选中的元素的value值叠加起来
                        oInputs.forEach(function (item) {
                            // checked可以设置和获取当前多选框单选框是否被选中，值是布尔值
                            if (item.checked) {
                                num += +item.value
                            }
                        })
                        //num就是点击后的搭配项目的总价钱
                        console.log(num);
                        //重新获取初始价钱标签的值 然后加上num就可以了
                        oResultPrice.innerHTML = "￥" + (+
                            oMasterPrice.innerHTML.substr(1) + num);
                    }
                })

            }



            //Tab切换
            function Tab(oBtns, oContents) {
                this.b = oBtns;
                this.c = oContents;
                var _this = this;
                this.b.forEach(function (item, index) {
                    item.onclick = function () {
                        //选项卡切换的核心代码
                        //所有选项卡切换的核心代码都是一致的，所以把这个方法写在原型对象上 就可以通用了
                        _this.a(index)
                    }
                })
            }
            //a方法 是点击标题后的选项卡切换核心代码
            Tab.prototype.a = function (index) {
                //先清空所有的
                var _this = this;
                this.b.forEach(function (item, index) {
                    item.classList.remove("active");
                    _this.c[index].classList.remove("active");
                })

                // console.log(index)
                this.b[index].classList.add("active");
                this.c[index].classList.add("active")

            }


            doTab1();

            function doTab1() {
                //获取所有的按钮
                var oBtns = document.querySelectorAll('.tabTitle h4');
                var oContents = document.querySelectorAll('.tabContent .tab-pane')

                new Tab(oBtns, oContents);
            }

        })
    </script>
</body>

</html>