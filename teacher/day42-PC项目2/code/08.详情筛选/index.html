<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>头部导航栏布局</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div class="outer">
        <!-- 头部区域 -->
        <header class="header">
            <div class="headerTop_out">
                <div class="headerTop">
                    <div class="headerTop_left">
                        <p>尚品汇欢迎您</p>
                        <p>
                            请
                            <a href="javascript:;">登录</a>
                            <a href="javascript:;">免费注册</a>
                        </p>
                    </div>
                    <div class="headerTop_right">
                        <a href="javascript:;">我的订单</a>
                        <a href="javascript:;">我的购物车</a>
                        <a href="javascript:;">我的尚品汇</a>
                        <a href="javascript:;">尚品汇会员</a>
                        <a href="javascript:;">企业采购</a>
                        <a href="javascript:;">关注尚品汇</a>
                        <a href="javascript:;">合作招聘</a>
                        <a href="javascript:;">商家后台</a>
                    </div>
                </div>

            </div>
            <div class="headerBottom">
                <h1 class="logo">
                    <a href="javascript:;">
                        <img src="./images/Logo.png" alt="">
                    </a>
                </h1>
                <div class="header_search">
                    <input type="text">
                    <button>搜索</button>
                </div>
            </div>
        </header>
        <div class="allnav_outer">
            <div class="allnav">
                <h2>所有商品分类</h2>
                <nav>
                    <a href="javascript:;">服装城</a>
                    <a href="javascript:;">美妆馆</a>
                    <a href="javascript:;">尚品汇超市</a>
                    <a href="javascript:;">全球购</a>
                    <a href="javascript:;">闪购</a>
                    <a href="javascript:;">团购</a>
                    <a href="javascript:;">有趣</a>
                    <a href="javascript:;">秒杀</a>
                </nav>
            </div>
        </div>
        <section class="con">
            <div class="conPoint">
                <a href="javascript:;">手机、数码、通讯手机</a>
                <a href="javascript:;">Apple苹果</a>
                <a>iphone 6S系类</a>
            </div>
            <div class="mainCon">
                <div class="previewArea">
                    <div class="preview">
                        <!-- 小图区域 -->
                        <div class="smallArea">
                            <img src="./images/s1.png" alt="">
                            <!-- 蒙版区域 -->
                            <!-- <div class="mask"></div> -->
                        </div>
                        <!-- 大图区域 -->
                        <!-- <div class="bigArea">
                            <img src="./images/b1.png" alt="">
                        </div> -->
                    </div>
                    <div class="prescroll">
                        <p class="left">&lt;</p>
                        <div class="listOut">
                            <ul class="list">

                            </ul>
                        </div>
                        <p class="right">&gt;</p>
                    </div>
                </div>
                <div class="detailArea">
                    <div class="priceArea">
                        <h3 class="title">Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机</h3>
                        <p class="con">推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有花费返</p>
                        <div class="price">
                            <div class="priceDetail">
                                <p>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</p>
                                <p>￥ <span>5299</span> 元</p>
                            </div>
                            <div class="buy">
                                <p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</p>
                                <p><span>加价购</span>满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</p>
                            </div>
                        </div>
                        <div class="support">
                            <div class="supportDetail">
                                <p>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</p>
                                <p>以旧换新，闲置手机回收 4G套餐超值抢 礼品购</p>
                            </div>
                            <div class="address">
                                <p>配&nbsp;送&nbsp;至</p>
                                <p>广东省 深圳市 宝安区</p>
                            </div>
                        </div>
                    </div>
                    <div class="chooseInsert">
                    </div>
                    <div class="chooseArea">
                        <dl>
                            <dt>选择颜色</dt>
                            <dd>金色</dd>
                            <dd>银色</dd>
                            <dd>黑色</dd>
                        </dl>
                        <dl>
                            <dt>内存容量</dt>
                            <dd>16G</dd>
                            <dd>32G</dd>
                            <dd>64G</dd>
                            <dd>128G</dd>
                        </dl>
                        <dl>
                            <dt>选择版本</dt>
                            <dd>公开版</dd>
                            <dd>移动版</dd>
                        </dl>
                        <dl>
                            <dt>选择优惠</dt>
                            <dd>官方标配</dd>
                            <dd>移动优惠版</dd>
                            <dd>电信优惠版</dd>
                        </dl>
                    </div>
                    <div class="goodsNum">
                        <div class="num">
                            <input type="text" value="1">
                            <button class="plus">+</button>
                            <button class="mins">-</button>
                        </div>
                        <div class="addCart">加入购物车</div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <script src="./js/data.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", function () {
            //每一个功能封装一个函数，避免变量冲突，减少使用全局变量


            //定义全局变量，保存缩略图点击的下标
            var thumbnailIndex = 0;



            //4.放大镜图片数据加载
            thumbnailData();

            function thumbnailData() {
                //因为存放缩略图的是li  要根据数据创建li 并把li插入到父级中 获取父级
                var oList = document.querySelector('.listOut .list')
                //获取缩略图的数据
                var imgData = goodData.imgsrc;
                //因为放大镜的小图区域也是初始话的第一张，所以获取元素，等待初始化
                var oSmallAreaImg = document.querySelector('.smallArea img')

                //根据数据 初始化缩略图
                imgData.forEach(function (item, index) {
                    //每读取一次数据变生成一个li
                    var newLi = document.createElement("li");
                    //li中是img
                    var newImg = new Image("img");
                    //img的图片是 数据的s  （s代表小图）
                    newImg.src = item.s;
                    //把创建img插入li中
                    newLi.appendChild(newImg);
                    //把li插入到父级中
                    oList.appendChild(newLi);
                })

                //初始化放大镜的小图
                oSmallAreaImg.src = imgData[0].s;

            }

            //1.放大镜效果
            manifier()

            function manifier() {
                var oPreview = document.querySelector('.preview');
                var oSmallArea = document.querySelector(".smallArea");

                //鼠标移入放大镜区域
                oPreview.onmouseenter = function () {
                    //创建蒙版区域
                    var oMask = document.createElement('div');
                    //可以使用classList来添加类名 每一个DOM对象上都有一个classList对象，可以通过classList对象的add remove toggle等方法来操作类名
                    oMask.classList.add("mask");
                    //把蒙版插入到小图区域中
                    oSmallArea.appendChild(oMask)

                    //创建大图区域
                    var oBigArea = document.createElement("div");
                    oBigArea.classList.add("bigArea")
                    //创建大图
                    var oBigImg = new Image();
                    oBigImg.src = goodData.imgsrc[thumbnailIndex].b;
                    //把大图添加给大图区域
                    oBigArea.appendChild(oBigImg);
                    //把大图插入到放大镜区域
                    oPreview.appendChild(oBigArea);


                    //鼠标移动
                    oPreview.onmousemove = function (e) {
                        //获取鼠标 到 放大镜边缘的距离 clientX - 放大镜区域到屏幕边缘的距离
                        var mouseToPriview = {
                            x: e.clientX - oSmallArea.getBoundingClientRect().left,
                            y: e.clientY - oSmallArea.getBoundingClientRect().top
                        }
                        //因为鼠标一直保持在蒙版中心，所以要获取蒙版一半的距离
                        var maskHalf = {
                            x: oMask.offsetWidth / 2,
                            y: oMask.offsetHeight / 2,
                        }
                        //计算蒙版跟随鼠标移动的距离  mouseToPriview - maskHalf 即可
                        var maskMove = {
                            x: mouseToPriview.x - maskHalf.x,
                            y: mouseToPriview.y - maskHalf.y,
                        }
                        //临界值判断
                        if (maskMove.x >= oSmallArea.offsetWidth - oMask.offsetWidth) {
                            maskMove.x = oSmallArea.offsetWidth - oMask.offsetWidth
                        } else if (maskMove.x <= 0) {
                            maskMove.x = 0;
                        }
                        if (maskMove.y >= oSmallArea.offsetHeight - oMask.offsetHeight) {
                            maskMove.y = oSmallArea.offsetHeight - oMask.offsetHeight
                        } else if (maskMove.y <= 0) {
                            maskMove.y = 0;
                        }

                        //赋值操作
                        oMask.style.left = maskMove.x + "px";
                        oMask.style.top = maskMove.y + "px";


                        //计算比例：
                        //大图可以移动的距离/小图可以移动的距离
                        var scale = (oBigArea.clientWidth - oBigImg.offsetWidth) / (oSmallArea
                            .clientWidth - oMask.offsetWidth)
                        //计算大图走动的位置
                        var bigImageMove = {
                            x: maskMove.x * scale,
                            y: maskMove.y * scale,
                        }
                        //赋值
                        oBigImg.style.left = bigImageMove.x + "px";
                        oBigImg.style.top = bigImageMove.y + "px";

                    }

                    // 鼠标移出
                    oPreview.onmouseleave = function () {
                        oSmallArea.removeChild(oMask)
                        oPreview.removeChild(oBigArea);
                    }
                }
            }

            //2.缩略图滚动效果
            thumbnail();

            function thumbnail() {
                var oListLis = document.querySelectorAll('.list li');
                var oList = document.querySelector('.list');
                var oRight = document.querySelector('.previewArea .prescroll .right')
                var oLeft = document.querySelector('.previewArea .prescroll .left')
                //移动的时候初始的位置（已经移动的距离）
                var tempLength = 0;
                //获取容器中显示的图片的长度
                var viewLength = 5;
                //每次图片移动的数量
                var everyLength = 2;
                //每次移动的距离
                var moveLength = everyLength * oListLis[0].offsetWidth;
                //总共可以移动的距离（判断临界值）（图片的总个数-容器里的个数）*每一个的宽度
                var allLength = (oListLis.length - viewLength) * oListLis[0].offsetWidth;
                //绑定点击事件
                oRight.onclick = function () {
                    //每次点击移动的时候（tempLength是当前的位置） 如果小于 （allLength总共可以走的距离），说明还没有走完，则继续走
                    if (tempLength < allLength) {
                        //每次移动的是两张，要判断最后是否是剩一张，如果是则直接走1张，如果不是则走两张
                        //allLength - tempLength 计算出还剩余多少没有走，判断剩余的如果大于等于每次走的，则说明还剩余两张以上
                        // if (tempLength <= (allLength - moveLength)) {}
                        if ((allLength - tempLength) >= moveLength) {
                            tempLength += moveLength;
                        } else {
                            tempLength = allLength;
                        }
                    }
                    oList.style.transform = "translateX(-" + tempLength + "px)"
                }
                //绑定点击事件
                oLeft.onclick = function () {
                    //还能不能能移动
                    console.log(tempLength, allLength)
                    if (tempLength > 0) {
                        if (tempLength > moveLength) {
                            tempLength -= moveLength;
                        } else {
                            tempLength = 0;
                        }
                    }
                    oList.style.transform = "translateX(-" + tempLength + "px)"
                }
            }


            //3.缩略图点击
            thumbnailClick();

            function thumbnailClick() {
                //给所有的li中的img绑定点击事件
                var oLisImgs = document.querySelectorAll('.listOut .list li img');
                var oSmallAreaImg = document.querySelector('.smallArea img')
                //遍历所有的缩略图
                oLisImgs.forEach(function (item, index) {
                    //对每一个缩略图绑定点击事件
                    item.onclick = function () {
                        //点击缩略图后，把缩略图对应的放大镜小图改变
                        oSmallAreaImg.src = item.src;

                        //点击的时候index就是代表当前的图片是数据中的第几张，方便创建大图的时候，知道当前是应该是展示第几张图
                        thumbnailIndex = index;
                    }
                })
            }


            //筛选详情
            chooseDetail();

            function chooseDetail() {
                //创建一个数组，数组4个值，分别保存每一个详情内容
                var arr = [0, 0, 0, 0];
                //获取所有的dl
                var oDl = document.querySelectorAll('.detailArea .chooseArea dl');
                //遍历所有的dl
                oDl.forEach(function (item, index) {
                    //给每一个dl添加一个index属性，保存的是下标
                    item.index = index;
                    //获取当前dl中所有的dd元素
                    var oDlDd = item.getElementsByTagName("dd");
                    //给所有的dd绑定点击事件
                    Array.from(oDlDd).forEach(function (item, index) {
                        item.onclick = function () {
                            //先清空所有的颜色
                            Array.from(oDlDd).forEach(function (item, index) {
                                item.style.color = "#666";
                            })
                            this.style.color = "red";

                            //获取点击的dd所在的dl的下标this.parentNode.index
                            //并且点击完更新数组
                            arr[this.parentNode.index] = this;
                            console.log(arr)

                            //获取被插入选择的元素
                            var oChooseInsert = document.querySelector('.chooseInsert');
                            //每次重新遍历数组之前 需要清空选择区域
                            oChooseInsert.innerHTML = "";
                            //遍历数组创建标签
                            arr.forEach(function (item, index) {
                                if (item) {
                                    //遍历数组 创建mark标签和a标签 用来包含选项 
                                    var oMark = document.createElement("mark");
                                    oMark.innerHTML = item.innerHTML;
                                    var oDelete = document.createElement("a");
                                    oDelete.innerHTML = "X";
                                    //设置a标签的时候，让a标签设置一个自定义属性，把当前a标签对应的dl的下标保存起来
                                    oDelete.dataset.index = index;
                                    oMark.appendChild(oDelete)
                                    // 把mark标签插入到页面中
                                    oChooseInsert.appendChild(oMark)


                                    //删除功能
                                    var oDeletes = document.querySelectorAll(
                                        'mark a');
                                    //对所有的删除按钮绑定点击事件
                                    oDeletes.forEach(function (item, index) {
                                        item.onclick = function () {
                                            // console.log(this)
                                            //删除当前的元素
                                            item.parentNode.parentNode
                                                .removeChild(item
                                                    .parentNode);
                                            //删除数组中的值(a标签上保存有当前a所对应的下标)
                                            arr[item.dataset.index] = 0;
                                            console.log(arr);

                                            // 清当前删除的dl中的所有dd的颜色 
                                            var oDeleDD = oDl[item.dataset.index].getElementsByTagName("dd");
                                            Array.from(oDeleDD).forEach(function(item){
                                                item.style.color = "#666"
                                            })
                                            //给当前清空的dd 默认第一个是红色
                                            oDeleDD[0].style.color = "red"

                                        }
                                    })
                                }

                            })
                        }
                    })

                })
            }




        })
    </script>
</body>

</html>